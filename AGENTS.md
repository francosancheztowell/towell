# Towell - Guía para Agentes

- **Producto**: Plataforma Laravel 12 para planeación y producción textil (planeación, tejido, urdido/engomado, atadores, tejedores, mantenimiento, configuración). Idioma y copy en español.
- **Stack**: PHP 8.2, Laravel, SQL Server (principal), Vite + Tailwind 4, Blade. Dependencias clave: `maatwebsite/excel` (importaciones), `dompdf/dompdf` (PDF), `twilio/sdk` (mensajería). Helpers autoload: `app/Helpers/format_helpers.php`, `app/Helpers/permission-helpers.php`.
- **Autenticación**: `app/Http/Controllers/AuthController.php` maneja login con número de empleado y contraseña (acepta hashes bcrypt o texto plano heredado), sesión regenerada al iniciar. Login por QR vía `loginQR`. Logout con POST `/logout`. Vista de login: `resources/views/login.blade.php`.
- **Permisos y módulos**: Los módulos viven en DB `SYSRoles` (jerarquía niveles 1-3, campo `orden` como key). Permisos por módulo: acceso/crear/modificar/eliminar/registrar en `SYSUsuariosRoles`. `app/Services/ModuloService.php` arma y cachea menús por usuario (TTL 1h, prefijo `modulos_v2`) y normaliza rutas; limpiar caché al modificar módulos. Gestión CRUD de módulos en `app/Http/Controllers/ModulosController.php` (soporta dependencias, imágenes en `public/images/fotos_modulos`, sincroniza permisos de nuevos módulos y borra caché).
- **Rutas**: Entrada en `routes/web.php` incluye `routes/public.php` (login/logout, QR, offline, favicon, CRUD de módulos sin auth para bootstrap) y, bajo `auth`, carga módulos: `routes/modules/*.php` (planeacion, tejido, tejedores, urdido, engomado, atadores, programa-urd-eng, configuracion, mantenimiento, telegram). Ejemplo: `routes/modules/planeacion.php` define catálogos (telares, eficiencia, velocidad, calendarios, aplicaciones, matriz hilos, pesos rollos), codificación de modelos, programa de tejido (liberar/dividir/balancear/etc.), descargas Excel/PDF y redirecciones legacy.
- **Frontend**: Blade principal `resources/views/layouts/app.blade.php` (usa Vite y tailwind). Otros layouts: `layouts/simple.blade.php`, `layouts/globalLoader.blade.php`. Vistas por módulo en `resources/views/{modulo}/...` y componentes en `resources/views/components`. Assets: `resources/js/app.js` importa `bootstrap.js` y `resources/css/app.css` (Tailwind @import y @source). PWA offline en `resources/views/offline.blade.php`.
- **Modelos**: Distribuidos por dominio en `app/Models/*` (Sistema, Planeacion, Tejido, Urdido, Engomado, Atadores, Tejedores, Mantenimiento, Inventario, etc.). Relaciones y atributos siguen nombres de tablas existentes en SQL Server; respeta convenciones locales (campos en español).
- **Configuración/env**: Variables en `.env` (no exponer en respuestas). DB por defecto `sqlsrv`. Certs locales en `localhost.crt/key/csr` para HTTPS local. Ajustes de caché/logs estándar de Laravel.
- **Comandos útiles**: `composer install`, `npm install`. Desarrollo: `php artisan serve` o `composer dev` (sirve, cola, logs y vite via concurrently), `npm run dev` / `npm run build`. Mantenimiento: `php artisan cache:clear config:clear route:clear view:clear`. Al tocar módulos o permisos, limpiar caché de modulos (ver `ModuloService::limpiarCacheUsuario` o usar comandos de caché).
- **Convenciones al modificar**: Mantén nombres y textos en español; no mover lógica de permisos sin revisar `ModuloService` y `SYSUsuariosRoles`. Evita tocar `vendor/` y `node_modules/`. Usa rutas nombradas existentes (ver archivos en `routes/modules`). Prefiere controladores/servicios existentes al crear nuevas funciones de permisos/menu. Para importación masiva usa los controladores en `Planeacion` y `Mantenimiento` que ya procesan Excel. No expongas datos sensibles de `.env` o credenciales.
